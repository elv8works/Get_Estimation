<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Keshava Jewellers - Employee Login</title>
<style>
body {
  font-family: "Inter", sans-serif;
  background: linear-gradient(135deg,#f8f0e3,#f3f4f6);
  margin:0; display:flex; justify-content:center; align-items:center; height:100vh;
}
.container {
  background:#fff; padding:40px; border-radius:20px;
  box-shadow:0 12px 30px rgba(0,0,0,0.2); width:380px; text-align:center;
  position:relative;
}
.container::before{
  content:""; position:absolute; top:-10px; left:-10px; right:-10px; bottom:-10px;
  border-radius:20px; background: linear-gradient(45deg,#4f46e5,#a855f7); z-index:-1;
}
h2 { color:#4f46e5; margin-bottom:25px; font-size:22px; }
input { width:100%; padding:12px; margin:12px 0; border:1px solid #ccc; border-radius:10px; font-size:15px; }
button {
  width:100%; padding:12px; margin-top:15px; background:#4f46e5; color:white; border:none; border-radius:10px;
  font-size:16px; cursor:pointer; position:relative; overflow:hidden; transition:0.3s;
}
button:disabled { background:gray; cursor:not-allowed; }
button:hover:not(:disabled) { background:#4338ca; }
button .loading { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); display:none; font-weight:bold; }
.show-loading { pointer-events:none; color:transparent; }
.show-loading .loading { display:block; color:white; }
#recaptcha-container { margin-top:10px; }

/* Footer branding */
.footer { font-size:12px; color:#555; margin-top:15px; }
</style>
</head>
<body>

<div class="container">
  <h2>Keshava Jewellers - Employee Login</h2>

  <input type="text" id="phoneNumber" placeholder="+91" value="+91">
  <div id="recaptcha-container"></div>

  <button id="getOtpBtn">Get OTP <span class="loading">Sending...</span></button>
  <input type="text" id="otpInput" placeholder="Enter OTP" style="display:none;">
  <button id="verifyOtpBtn" style="display:none;">Verify OTP <span class="loading">Verifying...</span></button>

  <div class="footer">© Keshava Jewellers</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDu5HrS1C-sL1mvTIpQ8Z_29l46SgmXugM",
  authDomain: "getestimation-e0978.firebaseapp.com",
  projectId: "getestimation-e0978",
  storageBucket: "getestimation-e0978.firebasestorage.app",
  messagingSenderId: "305257891317",
  appId: "1:305257891317:web:5b20c8e5121d0fbb9a0cbc",
  measurementId: "G-21C5H9BRQ7"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

// Registered employees mapping: phone → employee name
const employeeMap = {
  "+917975073574": "Sudhamsha",
  "+918861609330": "Samarth"
};

const phoneInput = document.getElementById("phoneNumber");
const otpInput = document.getElementById("otpInput");
const getOtpBtn = document.getElementById("getOtpBtn");
const verifyOtpBtn = document.getElementById("verifyOtpBtn");

window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { size: 'invisible' });
let confirmationResult;

function showLoading(btn, show){
  if(show) btn.classList.add("show-loading");
  else btn.classList.remove("show-loading");
}

getOtpBtn.addEventListener("click", ()=>{
  const phoneNumber = phoneInput.value.trim();
  if(!(phoneNumber in employeeMap)){
    alert("Your mobile number is not registered. Contact the employer.");
    return;
  }
  showLoading(getOtpBtn,true);

  auth.signInWithPhoneNumber(phoneNumber, window.recaptchaVerifier)
  .then(result => {
    confirmationResult = result;
    alert("OTP sent to " + phoneNumber);
    otpInput.style.display="block";
    verifyOtpBtn.style.display="block";
  })
  .catch(err=>{
    alert("Error sending OTP: " + err.message);
  })
  .finally(()=> showLoading(getOtpBtn,false));
});

verifyOtpBtn.addEventListener("click", ()=>{
  const otp = otpInput.value.trim();
  if(!otp) return alert("Enter OTP");
  showLoading(verifyOtpBtn,true);

  confirmationResult.confirm(otp)
  .then(result=>{
    const phone = result.user.phoneNumber;
    const employeeName = employeeMap[phone];
    // Save employee info and login time
    sessionStorage.setItem("loggedInEmployee", employeeName);
    sessionStorage.setItem("loginTime", Date.now());
    window.location.href = "estimation.html";
  })
  .catch(err=>{
    alert("Invalid OTP, try again!");
  })
  .finally(()=> showLoading(verifyOtpBtn,false));
});
</script>
</body>
</html>
