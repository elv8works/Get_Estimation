<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Keshava Jewellers - Employee Login</title>
<style>
body { font-family: "Inter", sans-serif; background:#f3f4f6; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; }
.container { background:white; padding:30px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); width:320px; text-align:center; }
input { width:100%; padding:10px; margin:10px 0; border:1px solid #ccc; border-radius:5px; }
button { width:100%; padding:10px; margin:10px 0; background:#4f46e5; color:white; border:none; border-radius:5px; cursor:pointer; }
button:disabled { background:gray; cursor:not-allowed; }
</style>
</head>
<body>

<div class="container">
  <h2>Employee Login</h2>
  <input type="text" id="phoneNumber" placeholder="+91" value="+91">
  <div id="recaptcha-container"></div>
  <button id="getOtpBtn">Get OTP</button>
  <input type="text" id="otpInput" placeholder="Enter OTP" style="display:none;">
  <button id="verifyOtpBtn" style="display:none;">Verify OTP</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

const allowedEmployees = ["+911234567890","+919876543210"]; // only registered employees

const getOtpBtn = document.getElementById("getOtpBtn");
const verifyOtpBtn = document.getElementById("verifyOtpBtn");
const phoneInput = document.getElementById("phoneNumber");
const otpInput = document.getElementById("otpInput");

window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { size: 'invisible' });

let confirmationResult;

getOtpBtn.addEventListener("click", ()=>{
  const phoneNumber = phoneInput.value.trim();
  if(!allowedEmployees.includes(phoneNumber)){
    alert("Your mobile number is not registered. Contact the employer.");
    return;
  }

  getOtpBtn.disabled = true;

  auth.signInWithPhoneNumber(phoneNumber, window.recaptchaVerifier)
  .then((result)=>{
    confirmationResult = result;
    alert("OTP sent to " + phoneNumber);
    otpInput.style.display = "block";
    verifyOtpBtn.style.display = "block";
  })
  .catch(err=>{
    alert("Error sending OTP: " + err.message);
    getOtpBtn.disabled = false;
  });
});

verifyOtpBtn.addEventListener("click", ()=>{
  const otp = otpInput.value.trim();
  if(!otp) return alert("Enter OTP");

  confirmationResult.confirm(otp)
  .then((result)=>{
    const userPhone = result.user.phoneNumber;
    sessionStorage.setItem("loggedInEmployee", userPhone);
    sessionStorage.setItem("loginTime", Date.now());
    window.location.href = "estimation.html";
  })
  .catch(err=>{
    alert("Invalid OTP, try again!");
  });
});
</script>
</body>
</html>
