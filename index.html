<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Keshava Jewellers - Estimation Slip</title>
<style>
body {
  font-family: "Inter", sans-serif;
  background-color: #f3f4f6;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 700px;
  margin: 40px auto;
  background: #fff;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
.logo {
  text-align: center;
  margin-bottom: 10px;
}
.logo img {
  width: 100px;
  height: auto;
}
h1, h3 {
  text-align: center;
  margin: 0;
}
h1 { color: #222; }
h3 { margin-bottom: 25px; color: #444; }
label { display: block; margin-bottom: 5px; font-weight: 500; color: #333; }
input, select { width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 5px; font-size: 15px; }
.radio-group { display: flex; gap: 20px; margin-bottom: 20px; }
.radio-group label { font-weight: 400; }
.btn-container { display: flex; justify-content: space-between; }
button { width: 48%; padding: 12px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; transition: 0.3s; }
.save-btn { background-color: #4f46e5; color: white; }
.save-btn:hover { background-color: #4338ca; }
#printBtn { background-color: gray; opacity: 0.6; cursor: not-allowed; color: white; }
#printBtn.active { background-color: #007bff; opacity: 1; cursor: pointer; }
/* Print layout */
@media print {
  body { background: white; margin: 0; text-align: center; }
  .container { width: 80mm; padding: 10px; margin: 0; box-shadow: none; border-radius: 0; }
  h1 { font-size: 16px; margin-bottom: 5px; }
  h3 { font-size: 13px; margin-bottom: 8px; }
  label { font-weight: bold; font-size: 12px; margin-bottom: 2px; display: inline-block; text-align: left; width: 100%; }
  input, select { border: none; padding: 2px 0; font-size: 12px; text-align: right; }
  .btn-container, .radio-group { display: none; }
  .logo img { width: 60px; }
  @page { size: 80mm auto; margin: 3mm; }
}
</style>
</head>
<body>
<div class="container">
  <div class="logo">
    <img src="kc.png" alt="Keshava Jewellers Logo">
  </div>
  <h1>Keshava Jewellers, Sagara</h1>
  <h3>Estimation Slip</h3>
  <form id="estimationForm">
    <label>Customer Name*</label>
    <input type="text" id="customerName" required>
    <label>Mobile Number</label>
    <input type="text" id="mobileNumber" maxlength="10" pattern="[0-9]{10}">
    <label>City</label>
    <input type="text" id="city">
    <label>Ornament Chosen</label>
    <input type="text" id="ornament">
    <label>Quantity (gms)</label>
    <input type="number" id="quantity" step="0.01">
    <label>Rate (â‚¹/gm)</label>
    <input type="number" id="rate" step="0.01">
    <div class="radio-group">
      <label><input type="radio" name="mcType" value="grams" checked> MC in grams</label>
      <label><input type="radio" name="mcType" value="percent"> MC in %</label>
    </div>
    <label>Making Charges</label>
    <input type="number" id="makingCharges" step="0.01">
    <label>Stone Charges</label>
    <input type="number" id="stoneCharges" step="0.01">
    <label>Employee Name</label>
    <select id="employee">
      <option value="Sudhamsha">Sudhamsha</option>
      <option value="Samarth">Samarth</option>
    </select>
    <label>Total Amount (Auto Calculated)</label>
    <input type="text" id="amount" readonly style="background:#f9fafb;font-weight:bold;">
    <div class="btn-container">
      <button type="button" class="save-btn" id="saveBtn">Save</button>
      <button type="button" id="printBtn" disabled>Print</button>
    </div>
  </form>
</div>
<script>
const qtyEl = document.getElementById("quantity");
const rateEl = document.getElementById("rate");
const mcEl = document.getElementById("makingCharges");
const stoneEl = document.getElementById("stoneCharges");
const amountEl = document.getElementById("amount");
const mcRadios = document.getElementsByName("mcType");
const saveBtn = document.getElementById("saveBtn");
const printBtn = document.getElementById("printBtn");

// Calculation
function calculateTotal() {
  const qty = parseFloat(qtyEl.value)||0;
  const rate = parseFloat(rateEl.value)||0;
  const mc = parseFloat(mcEl.value)||0;
  const stone = parseFloat(stoneEl.value)||0;
  const mcType = [...mcRadios].find(r=>r.checked)?.value;
  let total=0;
  if(mcType==="grams") total = (((qty+mc)*rate)+stone)*1.03;
  else total = (((qty+(qty*(mc/100)))*rate)+stone)*1.03;
  amountEl.value = total? total.toFixed(2):"";
}

[qtyEl, rateEl, mcEl, stoneEl].forEach(el=>el.addEventListener("input", calculateTotal));
mcRadios.forEach(r=>r.addEventListener("change", calculateTotal));

// Save
saveBtn.addEventListener("click", ()=>{
  const data = {
    customerName: document.getElementById("customerName").value.trim(),
    mobileNumber: document.getElementById("mobileNumber").value.trim(),
    city: document.getElementById("city").value.trim(),
    ornament: document.getElementById("ornament").value.trim(),
    quantity: qtyEl.value,
    rate: rateEl.value,
    mcType: [...mcRadios].find(r=>r.checked)?.value,
    makingCharges: mcEl.value,
    stoneCharges: stoneEl.value,
    employee: document.getElementById("employee").value,
    amount: amountEl.value
  };
  if(!data.customerName){ alert("Customer Name is mandatory!"); return;}
  const scriptURL="https://script.google.com/macros/s/AKfycbzVpwpYkrB-fa65HM-VqvESom7E2VSaKUt_4w8guvRyRKkSx_ueawWdnWMGhUpEhtLDyQ/exec";
  fetch(scriptURL,{method:"POST",body:JSON.stringify(data)})
    .then(res=>{
      if(res.ok){ alert("Saved successfully!"); printBtn.disabled=false; printBtn.classList.add("active"); }
      else alert("Error saving data!");
    })
    .catch(()=>alert("Error saving data!"));
});

// Print
printBtn.addEventListener("click",()=>{
  if(printBtn.disabled){ alert("Please save before printing!"); return; }
  window.print();
});
</script>
</body>
</html>
